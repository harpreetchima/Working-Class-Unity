# Nixpacks Configuration for Nuxt 4 SSR Deployment
# This file configures the build environment for Coolify deployments

[phases.setup]
# Use Node.js 20 LTS to meet Nuxt 4.2.1 requirements
# Required: ^20.19.0 || >=22.12.0
nixPkgs = ["nodejs_20"]

[phases.install]
# Delete package-lock.json to force fresh resolution of platform-specific
# native dependencies (oxc-parser, etc.) for Linux. The lock file generated
# on Windows doesn't include Linux native binaries.
# See: https://github.com/npm/cli/issues/4828
cmds = ["rm -f package-lock.json && npm install"]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "node .output/server/index.mjs"
