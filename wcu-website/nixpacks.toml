# Nixpacks Configuration for Nuxt 4 SSR Deployment
# This file configures the build environment for Coolify deployments

[phases.setup]
# Use Node.js 20 LTS to meet Nuxt 4.2.1 requirements
# Required: ^20.19.0 || >=22.12.0
nixPkgs = ["nodejs_20"]

[phases.install]
# Use npm install instead of npm ci to properly resolve platform-specific
# native dependencies (oxc-parser, etc.) for Linux when package-lock.json
# was generated on Windows. See: https://github.com/npm/cli/issues/4828
cmds = ["npm install --prefer-offline"]

[phases.build]
cmds = ["npm run build"]

[start]
cmd = "node .output/server/index.mjs"
